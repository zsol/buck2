"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[2476],{28453:(o,e,n)=>{n.d(e,{R:()=>t,x:()=>c});var s=n(96540);const i={},l=s.createContext(i);function t(o){const e=s.useContext(l);return s.useMemo(function(){return"function"==typeof o?o(e):{...e,...o}},[e,o])}function c(o){let e;return e=o.disableParentContext?"function"==typeof o.components?o.components(i):o.components||i:t(o.components),s.createElement(l.Provider,{value:e},o.children)}},63472:(o,e,n)=>{n.r(e),n.d(e,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>r});const s=JSON.parse('{"id":"users/languages/go/toolchains","title":"Toolchains","description":"Go toolchains in Buck2 come in two types: \\"regular\\" and \\"bootstrap\\".","source":"@site/../docs/users/languages/go/toolchains.md","sourceDirName":"users/languages/go","slug":"/users/languages/go/toolchains","permalink":"/docs/users/languages/go/toolchains","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"id":"toolchains","title":"Toolchains"},"sidebar":"main","previous":{"title":"Overview","permalink":"/docs/users/languages/go/overview"},"next":{"title":"Third-Party Packages","permalink":"/docs/users/languages/go/third_party_packages"}}');var i=n(74848),l=n(28453);const t={id:"toolchains",title:"Toolchains"},c="Toolchains",a={},r=[{value:"Hermetic Toolchains (Recommended)",id:"hermetic-toolchains-recommended",level:2},{value:"Toolchain Locations",id:"toolchain-locations",level:3},{value:"Example Configuration",id:"example-configuration",level:3},{value:"System Toolchains",id:"system-toolchains",level:2},{value:"Toolchain Locations",id:"toolchain-locations-1",level:3},{value:"Example Configuration",id:"example-configuration-1",level:3}];function d(o){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...o.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"toolchains",children:"Toolchains"})}),"\n",(0,i.jsx)(e.p,{children:'Go toolchains in Buck2 come in two types: "regular" and "bootstrap".'}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Regular toolchains"})," are used to build Go code."]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Bootstrap toolchains"})," are used to build the tools required to build Go\ncode."]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["A minimal setup requires ",(0,i.jsx)(e.code,{children:":go"}),", ",(0,i.jsx)(e.code,{children:":go_bootstrap"}),", and ",(0,i.jsx)(e.code,{children:":python_bootstrap"})," in your\n",(0,i.jsx)(e.code,{children:"toolchains//"})," cell."]}),"\n",(0,i.jsxs)(e.p,{children:["Additionally, a ",(0,i.jsx)(e.code,{children:":cxx"})," toolchain is required:"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"If you use CGo, you need a fully configured CXX toolchain"}),"\n",(0,i.jsxs)(e.li,{children:["If you don't use CGo, you can define it with a stub ",(0,i.jsx)(e.code,{children:"no_toolchain"})," rule"]}),"\n"]}),"\n",(0,i.jsx)(e.p,{children:'Each type of Go toolchain has two implementations: "system" and "hermetic".'}),"\n",(0,i.jsx)(e.h2,{id:"hermetic-toolchains-recommended",children:"Hermetic Toolchains (Recommended)"}),"\n",(0,i.jsx)(e.p,{children:"Hermetic toolchains are the recommended way to build Go code because they:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Make builds reproducible"}),"\n",(0,i.jsx)(e.li,{children:"Support all features of the Go rules"}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["Hermetic toolchains consist of two rules: ",(0,i.jsx)(e.code,{children:"go*_distr"})," and ",(0,i.jsx)(e.code,{children:"go*_toolchain"}),"."]}),"\n",(0,i.jsxs)(e.p,{children:["The ",(0,i.jsx)(e.code,{children:"*_distr"})," rules wrap Go distributions produced by ",(0,i.jsx)(e.code,{children:"go tool dist"}),", such as\nthose available at ",(0,i.jsx)(e.a,{href:"https://go.dev/dl/",children:"go.dev/dl"}),"."]}),"\n",(0,i.jsxs)(e.p,{children:["You can use either local or ",(0,i.jsx)(e.code,{children:"http_archive"})," Go distributions."]}),"\n",(0,i.jsx)(e.h3,{id:"toolchain-locations",children:"Toolchain Locations"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"@prelude//toolchains/go:go_toolchain.bzl"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"@prelude//toolchains/go:go_bootstrap_toolchain.bzl"})}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"example-configuration",children:"Example Configuration"}),"\n",(0,i.jsxs)(e.p,{children:["Here's an example of ",(0,i.jsx)(e.code,{children:"go_toolchain"})," using local Go distributions\n(",(0,i.jsx)(e.code,{children:"go_bootstrap_toolchain"})," is defined similarly):"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'load("@prelude//toolchains/go:go_toolchain.bzl", "go_distr", "go_toolchain")\n\n# Note: selects are resolved against execution-platform\ngo_distr(\n    name = "go_distr",\n    go_arch = select({\n        "config//cpu:arm64": "arm64",\n        "config//cpu:x86_64": "amd64",\n    }),\n    go_os = select({\n        "config//os:linux": "linux",\n        "config//os:macos": "darwin",\n    }),\n    go_root = select({\n        "config//os:linux": select({"config//cpu:x86_64": "path/to/go-linux-amd64"}),\n        "config//os:macos": select({"config//cpu:arm64": "path/to/go-darwin-arm64"}),\n    }),\n)\n\n# Note: selects are resolved against target-platform\ngo_toolchain(\n    name = "go",\n    env_go_arch = select({\n        "config//cpu:arm64": "arm64",\n        "config//cpu:x86_64": "amd64",\n    }),\n    env_go_os = select({\n        "config//os:linux": "linux",\n        "config//os:macos": "darwin",\n        "config//os:windows": "windows",\n    }),\n    go_distr = ":go_distr",\n    visibility = ["PUBLIC"],\n)\n'})}),"\n",(0,i.jsxs)(e.p,{children:["For a complete example using ",(0,i.jsx)(e.code,{children:"http_archive"}),", see\n",(0,i.jsx)(e.a,{href:"https://github.com/facebook/buck2/blob/main/examples/toolchains/go_toolchain/toolchains/BUCK",children:"examples/toolchains/go_toolchain"}),"."]}),"\n",(0,i.jsx)(e.h2,{id:"system-toolchains",children:"System Toolchains"}),"\n",(0,i.jsx)(e.p,{children:"System toolchains are not intended for production builds but can be used for\nexamples and simple projects. Note that some features of Go rules might not work\nwith system toolchains, such as building ASM files."}),"\n",(0,i.jsx)(e.h3,{id:"toolchain-locations-1",children:"Toolchain Locations"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"@prelude//toolchains/go:system_go_toolchain.bzl"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.code,{children:"@prelude//toolchains/go:system_go_bootstrap_toolchain.bzl"})}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"example-configuration-1",children:"Example Configuration"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'load("@prelude///toolchains/go:system_go_bootstrap_toolchain.bzl", "system_go_bootstrap_toolchain")\nload("@prelude///toolchains/go:system_go_toolchain.bzl", "system_go_toolchain")\n\nsystem_go_toolchain(\n    name = "go",\n    visibility = ["PUBLIC"],\n)\n\nsystem_go_bootstrap_toolchain(\n    name = "go_bootstrap",\n    visibility = ["PUBLIC"],\n)\n'})})]})}function h(o={}){const{wrapper:e}={...(0,l.R)(),...o.components};return e?(0,i.jsx)(e,{...o,children:(0,i.jsx)(d,{...o})}):d(o)}}}]);