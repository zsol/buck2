"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[5928],{28453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>l});var s=n(96540);const i={},r=s.createContext(i);function o(e){const t=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:t},e.children)}},53174:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"prelude/rules/python/python_binary","title":"python_binary","description":"python\\\\_binary","source":"@site/../docs/prelude/rules/python/python_binary.md","sourceDirName":"prelude/rules/python","slug":"/prelude/rules/python/python_binary","permalink":"/docs/prelude/rules/python/python_binary","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"ruleSidebar","previous":{"title":"prebuilt_python_library","permalink":"/docs/prelude/rules/python/prebuilt_python_library"},"next":{"title":"python_bootstrap_binary","permalink":"/docs/prelude/rules/python/python_bootstrap_binary"}}');var i=n(74848),r=n(28453);n(56289);const o={},l="python_binary",a={},d=[{value:"python_binary",id:"python_binary-1",level:2},{value:"Parameters",id:"parameters",level:4},{value:"Details",id:"details",level:4}];function c(e){const t={code:"code",em:"em",h1:"h1",h2:"h2",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"python_binary",children:"python_binary"})}),"\n",(0,i.jsx)(t.h2,{id:"python_binary-1",children:"python_binary"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-python",children:'def python_binary(\n    *,\n    name: str,\n    default_target_platform: None | str = None,\n    target_compatible_with: list[str] = [],\n    compatible_with: list[str] = [],\n    exec_compatible_with: list[str] = [],\n    visibility: list[str] = [],\n    within_view: list[str] = ["PUBLIC"],\n    metadata: OpaqueMetadata = {},\n    tests: list[str] = [],\n    modifiers: OpaqueMetadata = [],\n    _apple_platforms: dict[str, str] = {},\n    _build_info: dict[str, typing.Any] = {},\n    _create_manifest_for_source_dir: str = "prelude//python/tools:create_manifest_for_source_dir",\n    _cxx_hacks: str = "prelude//cxx/tools:cxx_hacks",\n    _cxx_toolchain: str = "gh_facebook_buck2_shims_meta//:cxx",\n    _exec_os_type: str = "prelude//os_lookup/targets:os_lookup",\n    _package_remotely: bool = select({"prelude//os/constraints:android": True, "DEFAULT": False}),\n    _python_internal_tools: str = "prelude//python/tools:python_internal_tools",\n    _python_toolchain: str = "gh_facebook_buck2_shims_meta//:python",\n    _target_os_type: str = "prelude//os_lookup/targets:os_lookup",\n    allow_cache_upload: None | bool = None,\n    anonymous_link_groups: bool = False,\n    auto_link_groups: bool = False,\n    base_module: None | str = None,\n    binary_linker_flags: list[str] = [],\n    bolt_flags: list[str] = [],\n    bolt_profile: None | str = None,\n    build_args: list[str] = [],\n    compile: None | bool = None,\n    compiler_flags: list[str] = [],\n    constraint_overrides: list[None | str] = [],\n    contacts: list[str] = [],\n    coverage_instrumentation_compiler_flags: list[str] = [],\n    cuda_compile_style: str = "mono",\n    cxx_main: str = "prelude//python/tools:embedded_main.cpp",\n    cxx_runtime_type: None | str = None,\n    deduplicate_merged_link_roots: bool = True,\n    default_host_platform: None | str = None,\n    default_platform: None | str = None,\n    defaults: dict[str, str] = {},\n    deps: list[str] = [],\n    deps_query: None | str = None,\n    devirt_enabled: bool = False,\n    distributed_thinlto_partial_split_dwarf: bool = False,\n    dummy_omnibus: None | str = None,\n    enable_distributed_thinlto: bool = False,\n    exe_allow_cache_upload: bool = False,\n    executable_deps: list[str] = [],\n    executable_name: None | str = None,\n    exported_needs_coverage_instrumentation: bool = False,\n    extension: None | str = None,\n    fat_lto: bool = False,\n    focused_list_target: None | str = None,\n    frameworks: list[str] = [],\n    header_namespace: None | str = None,\n    headers: list[str] | dict[str, str] = [],\n    headers_as_raw_headers_mode: None | str = None,\n    include_directories: list[str] = [],\n    inplace_build_args: list[str] = [],\n    labels: list[str] = [],\n    lang_compiler_flags: dict[str, list[str]] = {},\n    lang_platform_compiler_flags: dict[str, list[(str, list[str])]] = {},\n    lang_platform_preprocessor_flags: dict[str, list[(str, list[str])]] = {},\n    lang_preprocessor_flags: dict[str, list[str]] = {},\n    libraries: list[str] = [],\n    licenses: list[str] = [],\n    link_deps_query_whole: bool = False,\n    link_execution_preference: None | str = None,\n    link_group: None | str = None,\n    link_group_deps: list[str] = [],\n    link_group_map: None | str | list[(str, list[(None | str | list[None | str], str, None | str | list[str], None | str)], None | dict[str, typing.Any])] = None,\n    link_group_min_binary_node_count: None | int = None,\n    link_group_public_deps_label: None | str = None,\n    link_ordering: None | str = None,\n    link_style: str = "static",\n    link_whole: bool = False,\n    linker_extra_outputs: list[str] = [],\n    linker_flags: list[str] = [],\n    main: None | str = None,\n    main_function: None | str = None,\n    main_module: None | str = None,\n    make_py_package: None | str = None,\n    manifest_module_entries: None | dict[str, list[str] | dict[str, typing.Any]] = None,\n    native_link_strategy: None | str = None,\n    opt_by_default_enabled: bool = False,\n    package_split_dwarf_dwp: bool = False,\n    package_style: None | str = None,\n    par_style: None | str = None,\n    platform: None | str = None,\n    platform_compiler_flags: list[(str, list[str])] = [],\n    platform_deps: list[(str, list[str])] = [],\n    platform_headers: list[(str, list[str] | dict[str, str])] = [],\n    platform_linker_flags: list[(str, list[str])] = [],\n    platform_override: None | str = None,\n    platform_preload_deps: list[(str, list[str])] = [],\n    platform_preprocessor_flags: list[(str, list[str])] = [],\n    platform_srcs: list[(str, list[str | (str, list[str])])] = [],\n    post_linker_flags: list[str] = [],\n    post_platform_linker_flags: list[(str, list[str])] = [],\n    precompiled_header: None | str = None,\n    prefer_stripped_native_objects: bool = False,\n    prefer_stripped_objects: bool = False,\n    prefix_header: None | str = None,\n    preload_deps: list[str] = [],\n    preprocessor_flags: list[str] = [],\n    py_version_for_type_checking: None | str = None,\n    raw_headers: list[str] = [],\n    raw_headers_as_headers_mode: None | str = None,\n    repl_main: None | str = None,\n    repl_only_deps: list[str] = [],\n    resources: list[str] | dict[str, str] = [],\n    run_with_inplace: bool = False,\n    runtime_bundle: None | str = None,\n    runtime_bundle_full: bool = False,\n    runtime_dependency_handling: None | str = None,\n    runtime_env: None | dict[str, str] = None,\n    separate_debug_info: bool = False,\n    shard_typing: None | bool = None,\n    srcs: list[str | (str, list[str])] = [],\n    standalone_build_args: list[str] = [],\n    static_extension_finder: str = "prelude//python/tools:static_extension_finder.py",\n    static_extension_utils: str = "prelude//python/tools:static_extension_utils.cpp",\n    strip_libpar: str = "none",\n    strip_stapsdt: bool = False,\n    thin_lto: bool = False,\n    typing: bool = False,\n    use_anon_target_for_analysis: bool = False,\n    use_header_units: bool = False,\n    use_oss_python: bool = False,\n    use_rust_make_par: bool = False,\n    use_rust_make_par_incremental: bool = False,\n    version_selections: dict[str, str] = {},\n    version_universe: None | str = None,\n    weak_framework_names: list[str] = [],\n    zip_safe: None | bool = None,\n) -> None\n'})}),"\n",(0,i.jsxs)(t.p,{children:["A ",(0,i.jsx)(t.code,{children:"python_binary()"})," rule is used to build an executable Python package that includes Python sources and resources from all transitive dependencies."]}),"\n",(0,i.jsx)(t.h4,{id:"parameters",children:"Parameters"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"name"}),": name of the target"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"default_target_platform"}),": specifies the default target platform, used when no platforms are specified on the command line"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"target_compatible_with"}),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"compatible_with"}),": a list of constraints that are required to be satisfied for this target to be compatible with a configuration"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"exec_compatible_with"}),": a list of constraints that are required to be satisfied for this target to be compatible with an execution platform"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"visibility"}),": a list of visibility patterns restricting what targets can depend on this one"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"within_view"}),": a list of visibility patterns restricting what this target can depend on"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"metadata"}),": a key-value map of metadata associated with this target"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"tests"}),": a list of targets that provide tests for this one"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"modifiers"}),": an array of modifiers associated with this target"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"_build_info"}),": Build info that is passed along here will be late-stamped into a fb_build_info section on the output binary"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"allow_cache_upload"}),": Whether to allow uploading the output of this rule to be uploaded to cache when the action is executed locally if the configuration allows (i.e. there is a cache configured and the client has permission to write to it)."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"base_module"}),": The package in which the main module should reside in its final location in the binary. If unset, Buck uses the project-relative directory that contains the BUCK file."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"deduplicate_merged_link_roots"}),": When linking multiple top-level binaries with the ",(0,i.jsx)(t.code,{children:"merged"})," ",(0,i.jsx)(t.code,{children:".buckconfig"}),", coalesce root link rules which are identical across independent merged links."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"deps"}),": A list of ",(0,i.jsx)(t.code,{children:"python_library()"})," rules that specify Python modules to include in the binary \u2014 including all transitive dependencies of these rules."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"exe_allow_cache_upload"}),": Allow uploading native executable for caching. Only meaningful for native link strategy."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"labels"}),": Set of arbitrary strings which allow you to annotate a ",(0,i.jsx)(t.code,{children:"build rule"})," with tags that can be searched for over an entire dependency tree using ",(0,i.jsx)(t.code,{children:"buck query()"})," ."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"link_group_deps"}),": Additional targets to traverse when building link groups, but which should not be direct dependencies of the main executable."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"link_group_public_deps_label"}),': Surface nodes with this label as "public" nodes in the main executable when linking with with link groups.']}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"linker_flags"}),": Additional linker flags that should be applied to any linking which is specific to this rule. Note that whether these flags are used is dependent on the native link strategy selected in ",(0,i.jsx)(t.code,{children:".buckconfig"})," and currently applies only to the merged ",(0,i.jsx)(t.code,{children:".buckconfig"}),"; the ",(0,i.jsx)(t.code,{children:"separate"})," link strategy pulls in shared libraries that are linked in the context of the rules that own them, such as ",(0,i.jsx)(t.code,{children:"cxx_library()"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"main"}),": The Python file which serves as the entry point for the binary. The interpreter initiates execution of the binary with the code in this file."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"main_function"}),": Name of a Python function that will serve as the main entry point of the binary. The name is either a fully qualified name like ",(0,i.jsx)(t.code,{children:"foo.bar.baz"})," or it starts with a ",(0,i.jsx)(t.code,{children:"."})," like ",(0,i.jsx)(t.code,{children:".bar.baz"}),", in which case it is relative to the package containing the target. This should usually be a function defined within one of the dependencies of this target. This attribute should be preferred over ",(0,i.jsx)(t.code,{children:"main_module"})," or ",(0,i.jsx)(t.code,{children:"main"}),", and it is an error to specify more than one of these."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"main_module"}),": The python module that should be the entry point of the binary. This should be a module name within a ",(0,i.jsx)(t.code,{children:"python_library"})," that this binary depends on. Note that module names take ",(0,i.jsx)(t.code,{children:"base_module"})," of the library into account. This property is mutually exclusive with ",(0,i.jsx)(t.code,{children:"main"}),", and should be preferred to ",(0,i.jsx)(t.code,{children:"main"}),", which is deprecated."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"manifest_module_entries"}),": If present, it should be a ",(0,i.jsx)(t.code,{children:"string"})," -> ",(0,i.jsx)(t.code,{children:"entry"})," mapping that gets generated into a ",(0,i.jsx)(t.code,{children:"__manifest__"})," module in the executable. Top level string keys will be the names of variables in this module (so they must be valid Python identifiers). An ",(0,i.jsx)(t.code,{children:"entry"})," can be a list of ",(0,i.jsx)(t.code,{children:"string"}),"s, or a further ",(0,i.jsx)(t.code,{children:"string"}),"-keyed dictionary."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"package_style"}),": Used to override the global packaging style that is set in ",(0,i.jsx)(t.code,{children:"["}),".buckconfig",(0,i.jsx)(t.code,{children:" ]"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"platform"}),": The name of the Python platform ",(0,i.jsx)(t.em,{children:"flavor"})," to build against by default as defined in the buckconfig#",(0,i.jsx)(t.code,{children:"python"}),"section of ",(0,i.jsx)(t.code,{children:".buckconfig"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"preload_deps"}),": A list of C/C++ library dependencies that need to be loaded before any other libraries when the PEX starts up. This requires dynamic loader support, such as ",(0,i.jsx)(t.code,{children:"LD_PRELOAD"}),", found on most systems. This list is order- sensitive and the preload libraries listed here are passed down to the dynamic linker in the same order."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"py_version_for_type_checking"}),": This option will force the type checker to perform checking under a specific version of Python interpreter."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"shard_typing"}),": Determines if sharding should be enabled on a given target."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"typing"}),": Determines whether to perform type checking on the given target. Default is False."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"version_selections"}),": A mapping from library name to desired version. Versioned dependencies from the entire dependency tree with the given name will be used at the specified version, if available. Versioned libraries that are unspecified will be used at their respective default version."]}),"\n"]}),"\n",(0,i.jsx)(t.h4,{id:"details",children:"Details"}),"\n",(0,i.jsx)(t.p,{children:"Examples:"}),"\n",(0,i.jsx)(t.p,{children:"Build an executable from the Python files in the BUCK directory."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"\n# BUCK\n\npython_binary(\n  name = 'tailer',\n  main_module = 'tailer',\n  deps = [\n    ':tailerutils',\n  ],\n)\n\npython_library(\n  name = 'tailerutils',\n  # The main module, tailer.py, is specified here.\n  # (Separated out from the glob pattern for clarity.)\n  srcs = glob(['tailer.py', '*.py']),\n)\n\n"})})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);